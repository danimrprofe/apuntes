# 4. relaciones entre tablas

El problema de la informaci√≥n repetida

Una de las grandes ventajas de las bases de datos es que podemos tener toda la informaci√≥n que necesitamos almacenar en varias tablas, relacionadas entre ellas, en lugar de una √∫nica tabla enorme con toda la informaci√≥n. 

Se podr√≠a pensar en a√±adir una nueva columna (no la hag√°is) a la **tabla Peliculas** que se llamara G√©nero, de manera que por cada pel√≠cula almacenada tambi√©n tuviera su g√©nero. 

![](media/image37.png)

Si nos fijamos en esta soluci√≥n podemos ver que se est√° repitiendo el mismo valor muchas veces, por ejemplo, Ciencia-Ficci√≥n aparece en cuatro filas y Drama en otras tantas. 

![](media/image37.png)

¬øQu√© problemas podemos tener si lo hacemos as√≠?

1. Que en alg√∫n momento nos equivoquemos al teclear, y escribamos, por ejemplo, Ciencia-Fusi√≥n.
2. Qu√© decidamos cambiar el nombre de un g√©nero, y por tanto tendr√≠amos que cambiarlo en todas las filas.

**Crear tabla de g√©neros**

La informaci√≥n de g√©neros la vamos a crear en una nueva tabla e indicaremos de alguna forma que hay filas de la tabla PELICULAS y de la tabla GENEROS que est√°n relacionadas.

Creamos la tabla g√©neros, con los campos **id_genero** y **nombre_genero**. **id_genero** hay que marcarlo como **clave principal**. 

Al marcar **valor autom√°tico** a **SI**, no tendremos que rellenar este campo.

![](media/image38.png)


Y la guardamos con el nombre generos.

![](media/image39.png)

**Repaso de tablas**

Ahora mismo deber√≠ais tener 3 tablas:

![](media/image40.png)

Rellenar la tabla generos

Vamos a rellenar la tabla generos. En la primera columna no tenemos que poner nada, siempre se pondr√°n los valores autom√°ticamente cuando pasemos a la siguiente fila.

üö© Si no se autocompletan los n√∫meros, revisa que id_genero sea clave principal.

![](media/image41.png)

Informaci√≥n de int√©rpretes

Tambi√©n vamos a suponer que quisi√©ramos almacenar informaci√≥n (apellidos, nombre y nacionalidad) acerca de los principales int√©rpretes con cada una de nuestra pel√≠culas. 

A pesar de haber creado una tabla INT√âRPRETES  anteriormente, podr√≠amos haber pensado en agregar columnas a la tabla PELICULAS donde guardar la informaci√≥n acerca de sus protagonistas. 

![](media/image42.png)

Esta soluci√≥n es dif√≠cil de mantener y puede dar multitud de problemas y errores, por lo ya hab√≠amos creado una tabla INT√âRPRETES 

## Tipos de relaciones

Para ver la forma de establecer la relaci√≥n es necesario decidir, previamente, qu√© tipo de relaci√≥n existe entre las tablas. Existen tres tipos b√°sicos de relaciones entre tablas: 

**Uno a muchos (1:n)**

Cuando una fila de la primera tabla puede estar relacionada con muchas filas de la segunda tabla, pero una fila de la segunda s√≥lo est√° relacionada con una de la primera. 

Una pel√≠cula puede tener un √∫nico g√©nero pero un g√©nero puede serlo de varias pel√≠culas.

**Muchos a muchos (n:n)**

Esta clase de relaci√≥n ocurre cuando una fila de la primera tabla puede estar relacionada con muchas filas de la segunda tabla y una fila de la segunda tabla puede estarlo con muchas filas de la primera. 

Un ejemplo de este tipo lo tenemos en la relaci√≥n entre la tabla Peliculas y la tabla Interpretes

Una pel√≠cula en particular puede tener muchos int√©rpretes y viceversa.  

**Uno a uno (1:1)** 

Cuando una fila de la primera tabla s√≥lo puede estar relacionada con una fila de la segunda y viceversa.

Por ejemplo una tabla con pa√≠ses y otra con jefes de gobierno, dado que, normalmente, un pa√≠s s√≥lo tiene un jefe de gobierno y un jefe de gobierno lo es s√≥lo de un pa√≠s.  

Establecer relaciones entre tablas 

En funci√≥n del tipo de relaci√≥n, los pasos a realizar para indicarlas son distintos. 

A continuaci√≥n se explica al detalle las reglas b√°sicas para los tipos uno a muchos y muchos a muchos. 

## Relaci√≥n uno a muchos

Para este tipo de relaciones la soluci√≥n siempre es crear una nueva columna en la tabla del lado del muchos, es decir, debemos crear una nueva columna en la tabla cuyas filas s√≥lo pueden estar relacionadas con una fila de la otra tabla, de manera que el valor de ese campo me indique sin lugar a dudas con qu√© fila est√° relacionada de la otra tabla. 

En el caso de Generos y Peliculas, esto supone que tenemos que crear en Peliculas un nuevo campo que para cada pel√≠cula mantenga un valor que me indique sin error al g√©nero al que pertenece. 

Por tanto, la columna debe ser del mismo tipo de dato que la columna que sea clave primaria en la otra tabla y los valores que podr√° contener ser√° cualquiera de los valores que tome la clave primaria en dicha tabla. 

Crear columna g√©nero dentro de la tabla pel√≠culas

Es decir, en la tabla Peliculas tendremos que crear una columna del mismo tipo que a la que llamaremos Genero. 

![](media/image43.png)

Los valores que pondremos en esa columna estar√°n comprendidos en los distintos valores que toma ese valor en la **tabla Generos**. 

Rellenar g√©nero de las pel√≠culas

Como la columna que hemos creado en la tabla pel√≠culas es nueva, tendremos que completarla con el n√∫mero correspondiente al g√©nero al  que pertenece la pel√≠cula.

![](media/image44.png)

**Herramienta relaciones**

Falta indicarle que las dos tablas est√°n relacionadas y que vamos a utilizar para mantener dicha relaci√≥n la nueva columna id_genero que hemos creado en peliculas. 

Para realizar esta operaci√≥n tenemos que abrir la herramienta QUE SOLO ENCONTRAR√âIS EN LA VENTANA PRINCIPAL, llamada Relaciones. 

![](media/image45.png)

Ver√©is que se abre una ventana nueva.

A√±adir las tablas que vamos a utilizar

Lo primero que nos ocurre nada m√°s entrar en la ventana Relaciones. Seleccionamos cada tabla y le damos a a√±adir.

![](media/image46.png)

Deberemos ver esto. Las tablas que aqu√≠ vemos las podremos unir con flechas. Estas flechas que pondremos indicar√°n las relaciones que tienen entre ellas.

![](media/image47.png)

## Relaci√≥n PELICULAS - GENEROS

A continuaci√≥n ya podemos establecer la relaci√≥n que queremos indicar. Para ello pinchamos en el icono que aparece a la derecha en la ventana relaciones 

![](media/image48.png)

Entonces, nos debe aparecer una ventana donde primero debemos indicar las tablas que queremos relacionar para, a continuaci√≥n, elegir en funci√≥n de qu√© columna vamos a establecer la relaci√≥n. Deber√≠a quedar as√≠:

![](media/image49.png)

En la parte inferior de esta ventana veremos que nos pide que indiquemos dos opciones: 

- Opciones de actualizaci√≥n 
- Opciones de eliminaci√≥n

Nos ofrece cuatro posibilidades para cada una de ellas. Estas opciones sirven para indicar qu√© hacer si alg√∫n valor del campo de clave primaria que est√° siendo referenciada (en nuestro caso Id_genero) sufre alguna modificaci√≥n o si esa fila es eliminada.

Para la actualizaci√≥n, lo normal suele ser elegir la posibilidad de actualizar en cascada, y para el borrado no existe una opci√≥n preferida sino que depender√° bastante del contexto, en nuestro caso, para esta relaci√≥n, indicaremos poner a nulos. 

![](media/image51.png)

Le damos a aceptar

## Visualizar la relaci√≥n creada

Una vez hemos terminado de indicar la relaci√≥n, √©sta debe aparecer indicada tal y como se muestra.

![](media/image52.png)

Ahora aparece una l√≠nea uniendo ambas tablas y que en el extremo de esa l√≠nea;

- En el lado de la tabla Generos aparece el valor 1
- En el extremo de la tabla Peliculas, nos aparece el valor n. 

Estos valores nos est√°n indicando que el tipo de relaci√≥n es de **uno (1) a muchos (n). **

## Relaci√≥n PELICULAS - INTERPRETES

En este caso puede darse el caso de:

- 1 pel√≠cula que tiene N int√©rpretes
- 1 int√©rprete que participa en N pel√≠culas

La relaci√≥n entre pel√≠culas e int√©rpretes es de muchos a muchos (N a N).

Cuando esto pasa, no basta con a√±adir una columna. Necesitamos crear una nueva tabla.

**Crear tabla protagonistas**

A esta **tabla** la llamaremos **Protagonistas** con, al menos, dos columnas:

- Identificador de pel√≠cula
- Identificador de int√©rprete
  
Cada una de ellas para apuntar a cada una de las claves primarias respectivas de las tablas que queremos relacionar

Cada fila de esta tabla va a representar las relaciones que existen entre las filas de ambas tablas. 

![](media/image53.png)

**Rellenar filas de la tabla**

Rellenaremos la tabla, asignando a cada id de pel√≠cula, un id de int√©rprete. La tabla es la que v√©is a la izquierda. Si os fij√°is:

- La pel√≠cula 1 es blade runner, protagonizada por Harrison ford (int√©rprete n√∫mero 1)
- La pel√≠cula 2 es la guerra de las galaxias, protagonizada tambi√©n por √©l (int√©rprete 1)
- Etc.

![](media/image54.png)

Como v√©is la tabla protagonistas enlaza las pel√≠culas con sus int√©rpretes, y viceversa.

# Relaci√≥n entre PELICULAS - INTERPRETES (protagonistas)

Una vez que tenemos creada esta tabla nos falta indicar las relaciones existentes, siguiendo la misma mec√°nica que hemos visto en el anterior apartado. 

As√≠, una vez que nos hemos situado de nuevo en la ventana Relaciones y hemos a√±adido las tablas que queremos relacionar a dicha ventana. 

Agregamos la tabla protagonistas

![](media/image55.png)

Aqu√≠ v√©is las dos tablas que hemos a√±adido, pero que no est√°n conectadas con nada m√°s. Ahora vamos a enlazar estas 3 tablas entre s√≠:

![](media/image56.png)

Relaci√≥n pel√≠culas y protagonistas

![](media/image58.png)

Relaci√≥n Protagonistas e Interpretes

Del mismo modo relacionamos estas dos tablas, a trav√©s del campo id_interprete que aparece en ambas tablas.

![](media/image59.png)

## Resumen de relaciones

Resumiendo, al final las relaciones que hemos creado tienen que quedar as√≠. Si ten√©is as√≠ las relaciones, pod√©is pasar al siguiente apartado.

![](media/image60.png)


